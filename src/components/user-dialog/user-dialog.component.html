<h2 mat-dialog-title class="dialog-title">{{ data.mode === 'add' ? 'Add User' : 'Edit User' }}</h2>

<mat-dialog-content class="dialog-content">
    <form [formGroup]="userForm" class="user-dialog-form">
        <!-- Name Field -->
        <mat-form-field appearance="fill" class="full-width">
            <mat-label>Name</mat-label>
            <input matInput formControlName="userName" placeholder="Enter user's name" />
            @if(userForm.get('userName')?.hasError('required')) {
            <mat-error>Name is required</mat-error>
            }
        </mat-form-field>

        <!-- Email Field -->
        <mat-form-field appearance="fill" class="full-width">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" placeholder="Enter user's email" />
            @if(userForm.get('email')?.hasError('required')) {
            <mat-error>Email is required</mat-error>
            }
            @if(userForm.get('email')?.hasError('email')) {
            <mat-error>Please enter a valid email address</mat-error>
            }
        </mat-form-field>

        <!-- Password Field (Only for Add Mode) -->
        @if(data.mode === 'add') {
        <mat-form-field appearance="fill" class="full-width">
            <mat-label>Password</mat-label>
            <input matInput type="password" formControlName="password" placeholder="Enter a password" />
            @if(userForm.get('password')?.hasError('required')) {
            <mat-error>Password is required</mat-error>
            }
        </mat-form-field>
        }

        <!-- Roles Management -->
        <mat-form-field class="example-chip-list full-width">
            <mat-label>Roles</mat-label>
            <mat-chip-grid #chipGrid aria-label="Role selection">
              @for (role of roles; track role) {
                <mat-chip-row (removed)="removeRole(role)">
                  {{ role }}
                  <button matChipRemove [attr.aria-label]="'Remove ' + role">
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip-row>
              }
            </mat-chip-grid>
            <input placeholder="New Role..." #roleInput [formControl]="roleCtrl"
                   [matChipInputFor]="chipGrid" [matAutocomplete]="auto"
                   [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                   (matChipInputTokenEnd)="addRole($event)" />
            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
              @for (role of allRoles; track role) {
                <mat-option [value]="role">{{ role }}</mat-option>
              }
            </mat-autocomplete>
          </mat-form-field>
    </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
    <button mat-button class="cancel-button" (click)="cancel()">Cancel</button>
    <button mat-raised-button color="primary" class="save-button" [disabled]="userForm.invalid" (click)="save()">Save</button>
</mat-dialog-actions>